<html>
<head>
	<script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
	<script src="http://code.jquery.com/jquery-1.11.1.js"></script>	
	<script src="/js/knowledge.js"></script>	
	<script src="/js/dialogue.js"></script>	

	<style>
		.actor {
			font-weight: bold;
		}

		.role {
			font-weight: bold;
		}

		#instructions p {
			font-style: italic;
		}

		#dialogue {
			display: none;
		}

		#who {
			border-bottom: 1px solid #000;
		}
	</style>


	<script>
	 function ready(){
	 	gameId = 'game ' + window.location.pathname.split("/")[2];
	 	console.log(gameId);


	 	names = ["Pam", "Kit", "Van", "Lin"];
	 	name = names[Math.floor(Math.random() * names.length)];
	 	character = {
	 		knowledge : {},
	 		name : name
	 	}

	 	maxKnowledge = 6;
	 	nKnowledge = Math.floor(Math.random() * maxKnowledge) + 3;

	 	for(var i = 0; i < nKnowledge; i++){
	 		k = randomKnowledge();
	 		character.knowledge[k.what] = {where: k.where, when: k.when};
	 	}

	 	console.log(character);

	 	allSubjects = ["Joe", "Bob", "Jane", "Cat", "Alice", "Fin", "Mark", "the document safe", "the plans", "the exit", "the gun"];

	 	// this should be a real character with knowledge
	 	player = {
	 		name: "Tim",
	 		knowledge : {}
	 	}

	 	$("#instructions .actor2").html(player.name);
	 	$("#instructions .actor1").html(character.name);

	 	$(".actor1 .actor").html(character.name);
	 	$(".actor2 .actor").html(player.name);
	 	$(".actor1-name").html(character.name);
	 	$(".actor2-name").html(player.name);


		var socket = io();
		socket.emit('join', gameId);

		socket.on('receive-question', function(data){
			console.log("received  question: " );
			console.log(data);
		});

		// s.on("connection",function(socket){
		// 	console.log("connected");
		// 	socket.join("game " + gameId);
		// })
		// $('form').submit(function(e){
		// 	e.preventDefault();
		// 	socket.emit('game ' + gameId, "yoyoyo");
		// });

		// socket.on('game ' + gameId, function(msg){
  // 		  console.log(msg);
  // 		});

		function showOptions(){
			for(var i = 0; i < allSubjects.length; i++){
				$("#subject select").append("<option value='"+allSubjects[i]+"'>"+allSubjects[i]+"</option>")
			}
		}

		$("#subject").submit(function(e){
			e.preventDefault();
			subject = $("#subject select").val();


			args = {
				dialogue: dialogues[1],
				subject: subject,
				character1: character,
				character2: player
			}

			socket.emit("submit-question", args);


			populateDialogue($("#dialogue"), args);

			
			$("#subject").hide();
			showScript();
		});



		function showScript(){
			$("#dialogue").show();
			$(".response").show();
  			$("#answers li").hide();
  			$("#answers").show();
  			$(".elipses").remove();
  			$("p").show();
		}

		showOptions();

  		$("#options li").click(function(e){
  			i = $("#options li").index($(this));
  			answer = $($("#answers li")[i]).text();
	  		
  			$("#options").remove();
  			$(".question").append($(this).text());


	  		$("#answers").remove();
	  		$(".response").append(answer);
	  		$("#options li").off("click");

	  		showScript();

  		})
	}

	 document.addEventListener("DOMContentLoaded", ready, false);

	</script>
</head>
<body>
	<div id="instructions">
		<div id="who">
		<p><span class="role actor1">Jim</span> talking to <span class="role actor2">Bob</span> (<b>YOU</b>)</p>
		</div>
		<form id="subject" action="">
			<p><label>Choose a subject to ask about</label> <select name=""></select> <input type="submit" value="ask" /></p>
		</form>
	</div>
	<div id="dialogue">
	</div>
</body>
</html>