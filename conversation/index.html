<html>
<head>
	<script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
	<script src="http://code.jquery.com/jquery-1.11.1.js"></script>	
	<script src="js/knowledge.js"></script>	

	<style>
		.actor {
			font-weight: bold;
		}

		.role {
			font-weight: bold;
		}

		#instructions p {
			font-style: italic;
		}

		#dialogue {
			display: none;
		}

		#who {
			border-bottom: 1px solid #000;
		}
	</style>


	<script>
	 function ready(){


	 	names = ["Pam", "Kit", "Van", "Lin"];
	 	name = names[Math.floor(Math.random() * names.length)];
	 	character = {
	 		knowledge : {},
	 		name : name
	 	}

	 	maxKnowledge = 6;
	 	nKnowledge = Math.floor(Math.random() * maxKnowledge) + 3;

	 	for(var i = 0; i < nKnowledge; i++){
	 		k = randomKnowledge();
	 		character.knowledge[k.what] = {where: k.where, when: k.when};
	 	}

	 	console.log(character);

	 	allSubjects = ["Joe", "Bob", "Jane", "Cat", "Alice", "Fin", "Mark", "the document safe", "the plans", "the exit", "the gun"];
	 	you = "Tim";

	 	$("#instructions .actor2").html(you);
	 	$("#instructions .actor1").html(character.name);

	 	$(".actor1 .actor").html(character.name);
	 	$(".actor2 .actor").html(you);
	 	$(".actor1-name").html(character.name);
	 	$(".actor2-name").html(you);


		// var socket = io();
		// $('form').submit(function(e){
		// 	e.preventDefault();
		// 	socket.emit('chat message', $('#m').val());
		// 	$('#m').val('');
		// });

		// socket.on('chat message', function(msg){
  // 		  $('#messages').append($('<li>').text(msg));
  // 		});

		function showOptions(){
			for(var i = 0; i < allSubjects.length; i++){
				$("#subject select").append("<option value='"+allSubjects[i]+"'>"+allSubjects[i]+"</option>")
			}
		}

		$("#subject").submit(function(e){
			e.preventDefault();
			subject = $("#subject select").val();
			console.log(subject);
			console.log(character.knowledge[subject]);
			$(".question").append(questionAbout(subject));
			$(".response").append(answerFor(subject, character.knowledge[subject]));
			$("#subject").hide();
			showScript();
		});

		function showScript(){
			$("#dialogue").show();
			$(".response").show();
  			$("#answers li").hide();
  			$("#answers").show();
  			$(".elipses").remove();

  			$("p").show();
		}

		showOptions();

  		$("#options li").click(function(e){
  			i = $("#options li").index($(this));
  			answer = $($("#answers li")[i]).text();
	  		
  			$("#options").remove();
  			$(".question").append($(this).text());


	  		$("#answers").remove();
	  		$(".response").append(answer);
	  		$("#options li").off("click");

	  		showScript();

  		})
	}

	 document.addEventListener("DOMContentLoaded", ready, false);

	</script>
</head>
<body>
	<div id="instructions">
		<div id="who">
		<p><span class="role actor1">Jim</span> talking to <span class="role actor2">Bob</span> (<b>YOU</b>)</p>
		</div>
		<form id="subject" action="">
			<p><label>Choose a subject to ask about</label> <select name=""></select> <input type="submit" value="ask" /></p>
		</form>
	</div>
	<div id="dialogue">
		<p class="actor1">
			<span class="actor">Jim</span> Howdy <span class="actor2-name">Bob</span>.
		</p>
		<p class="actor2">
			<span class="actor">Bob</span> How's it going, <span class="actor1-name">Jim</span>?
		</p>
		<p>
			<span class="actor">Jim</span> Can't complain, can't complain.
		</p>
		<p class="question actor2">
			<span class="actor">Bob</span> Hey, 
		</p>
		<p class="response actor1">
			<span class="actor">Jim</span> 
		</p>
		<p class="actor2">
			<span class="actor">Bob</span> Ok well, thanks.
		</p>
		<p class="actor1">
			<span class="actor">Jim</span> No problem, take it easy.
		</p>
	</div>
</body>
</html>